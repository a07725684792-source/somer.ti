<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e2e8f0">
    <meta name="description" content="أداة بومودورو عربية لزيادة الإنتاجية والتركيز">
    <title>سومر - أداة البومودورو العربية</title>

    <!-- فافيكون (لوغو الموقع) -->
    <link rel="icon" type="image/png" href="https://iili.io/KREI5cF.md.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* متغيرات التصميم الموحدة */
        :root {
            /* الألوان الرئيسية */
            --color-primary-dark: #e2e8f0;
            --color-primary-light: #ffffff;
            --color-accent: #4fd1c5;
            --color-white: #ffffff;
            --color-text: #2d3748;
            --color-text-secondary: #718096;
            --color-border: #e2e8f0;
            --color-background: #f7fafc;
            
            /* تأثيرات الظل */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 5px 10px rgba(0, 0, 0, 0.05);
            
            /* أنماط الزوايا */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            /* مسافات */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
        }

        /* أنماط الخطوط */
        * {
            font-family: 'Tajawal', 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* شريط التنقل العلوي */
        .navbar {
            background-color: var(--color-primary-dark);
            padding: var(--space-md) var(--space-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--color-border);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .navbar-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: var(--shadow-lg);
            border: 3px solid var(--color-accent);
            transition: border-color 0.3s;
        }

        .navbar-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-text);
            transition: color 0.3s;
        }

        .navbar-nav {
            display: flex;
            gap: var(--space-xl);
        }

        .nav-link {
            color: var(--color-text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
            padding: var(--space-sm) 0;
        }

        .nav-link:hover {
            color: var(--color-accent);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 2px;
            background-color: var(--color-accent);
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        /* زر تبديل الوضع الليلي */
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #edf2f7;
            color: #4a5568;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            position: absolute;
            left: 20px;
            top: 20px;
        }

        .theme-toggle:hover {
            background-color: var(--color-accent);
            color: white;
            transform: rotate(15deg);
        }

        /* المحتوى الرئيسي */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl);
        }

        /* أزرار التنقل بين الصفحات */
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: var(--space-2xl);
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-lg);
            background-color: var(--color-primary-light);
            color: var(--color-text);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .nav-tab.active {
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* الصفحات */
        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* البطاقات */
        .card {
            background-color: var(--color-primary-light);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-xl);
            transition: all 0.3s ease;
            border: 1px solid var(--color-border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        /* المؤقت */
        .timer-display {
            font-size: 5rem;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            color: var(--color-accent);
            margin: var(--space-xl) 0;
            text-shadow: 0 0 15px rgba(79, 209, 197, 0.3);
            text-align: center;
            transition: color 0.3s;
        }

        .timer-progress {
            width: 100%;
            height: 12px;
            background-color: var(--color-border);
            border-radius: var(--radius-lg);
            margin: var(--space-xl) 0;
            overflow: hidden;
        }

        .timer-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), #2dd4bf);
            width: 0%;
            transition: width 1s linear;
            border-radius: var(--radius-lg);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
        }

        /* الأزرار العامة */
        .btn {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
        }

        .btn-primary:hover {
            background-color: #38b2ac;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background-color: var(--color-primary-light);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background-color: var(--color-border);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .timer-modes {
            display: flex;
            justify-content: center;
            margin-bottom: var(--space-xl);
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .timer-mode {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-lg);
            background-color: var(--color-primary-light);
            color: var(--color-text);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .timer-mode.active {
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
        }

        .timer-mode:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quote-container {
            margin: var(--space-xl) 0;
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            background-color: var(--color-primary-light);
            font-style: italic;
            text-align: center;
            transition: opacity 0.5s ease;
            font-size: 1.2rem;
            border: 1px solid var(--color-border);
        }

        /* الإحصائيات */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-xl);
        }

        .stat-card {
            background-color: var(--color-primary-light);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            transition: transform 0.3s;
            border: 1px solid var(--color-border);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--color-accent);
            margin-bottom: var(--space-sm);
            transition: color 0.3s;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--color-text-secondary);
            transition: color 0.3s;
        }

        /* عناصر الإعدادات */
        .settings-title {
            font-size: 1.5rem;
            margin-bottom: var(--space-lg);
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: color 0.3s;
        }

        .setting-item {
            margin-bottom: var(--space-lg);
        }

        .setting-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: var(--color-text);
            font-size: 1.1rem;
            transition: color 0.3s;
        }

        .setting-input {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            background-color: var(--color-primary-dark);
            color: var(--color-text);
            transition: all 0.3s;
            font-size: 1rem;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(79, 209, 197, 0.2);
        }

        /* المهام */
        .todo-container {
            margin-top: var(--space-xl);
        }

        .todo-form {
            display: flex;
            margin-bottom: var(--space-lg);
        }

        .todo-input {
            flex: 1;
            padding: var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            background-color: var(--color-primary-dark);
            color: var(--color-text);
            transition: all 0.3s;
            font-size: 1rem;
        }

        .todo-input:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .todo-add {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .todo-add:hover {
            background-color: #38b2ac;
        }

        .todo-list {
            list-style: none;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: var(--space-md);
            border-bottom: 1px solid var(--color-border);
            transition: all 0.3s;
        }

        .todo-item:hover {
            background-color: var(--color-primary-dark);
            border-radius: var(--radius-md);
        }

        .todo-checkbox {
            margin-left: var(--space-md);
            width: 20px;
            height: 20px;
            accent-color: var(--color-accent);
        }

        .todo-text {
            flex: 1;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .todo-text.completed {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .todo-delete {
            background: none;
            border: none;
            color: #fc8181;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .todo-delete:hover {
            transform: scale(1.2);
        }

        /* الشارات */
        .badges-container {
            margin-top: var(--space-xl);
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .badge {
            background-color: var(--color-primary-light);
            border-radius: 50%;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--color-border);
        }

        .badge:hover {
            transform: scale(1.1) rotate(5deg);
            border-color: var(--color-accent);
        }

        .badge.locked {
            filter: grayscale(1);
            opacity: 0.5;
        }

        .badge-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-primary-dark);
            color: var(--color-text);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            border: 1px solid var(--color-border);
        }

        .badge:hover .badge-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* الأصوات */
        .sound-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-top: var(--space-md);
        }

        .sound-btn {
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background-color: var(--color-primary-light);
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.3s;
        }

        .sound-btn.active {
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
            border-color: var(--color-accent);
        }

        .sound-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        /* التحدي */
        .challenge-buttons {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        /* التذييل */
        footer {
            text-align: center;
            margin-top: var(--space-2xl);
            padding: var(--space-xl) 0;
            border-top: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            font-size: 1rem;
        }

        /* عداد المستخدمين */
        .user-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--color-accent);
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* التجاوب مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .navbar {
                padding: var(--space-md);
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .navbar-nav {
                gap: var(--space-md);
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .navbar-actions {
                margin-top: var(--space-md);
            }
            
            .timer-display {
                font-size: 3.5rem;
            }
            
            .timer-controls, .timer-modes, .challenge-buttons {
                flex-direction: column;
            }
            
            .btn, .timer-mode {
                width: 100%;
                justify-content: center;
            }
            
            .container {
                padding: var(--space-md);
            }
            
            .card {
                padding: var(--space-lg);
            }
            
            .theme-toggle {
                position: relative;
                left: 0;
                top: 0;
                margin-bottom: var(--space-md);
            }
            
            .user-counter {
                bottom: 10px;
                left: 10px;
                right: 10px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .timer-display {
                font-size: 2.8rem;
            }
            
            .navbar-logo {
                width: 60px;
                height: 60px;
            }
            
            .navbar-title {
                font-size: 1.5rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .badges-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .badge {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
        }

        /* تأثيرات النقر */
        .clickable {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .clickable:active {
            transform: scale(0.97);
        }

        /* رسائل الإشعارات */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--color-primary-light);
            color: var(--color-text);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            z-index: 10000;
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            max-width: 350px;
            border: 1px solid var(--color-border);
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-icon {
            font-size: 1.5rem;
            color: var(--color-accent);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: var(--space-xs);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* إعدادات الصوت المتقدمة */
        .custom-sound-container {
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-border);
        }

        .custom-sound-form {
            display: flex;
            margin-top: var(--space-md);
        }

        .custom-sound-input {
            flex: 1;
            padding: var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            background-color: var(--color-primary-dark);
            color: var(--color-text);
            font-size: 1rem;
        }

        .custom-sound-add {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            background-color: var(--color-accent);
            color: var(--color-primary-dark);
            cursor: pointer;
            font-weight: 600;
        }

        /* عناصر تحكم الصوت */
        .audio-controls {
            margin-top: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .volume-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: var(--radius-lg);
            background: var(--color-border);
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-accent);
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-accent);
            cursor: pointer;
        }
    </style>
</head>
<body class="light-mode">
    <!-- زر تبديل الوضع الليلي/النهاري في أعلى يسار الصفحة -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <!-- شريط التنقل العلوي -->
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="https://iili.io/KREI5cF.md.png" alt="شعار سومر" class="navbar-logo">
            <div class="navbar-title">سومر</div>
        </div>
        <div class="user-counter" style="position: relative; bottom: auto; left: auto; animation: none;">
            <i class="fas fa-users"></i>
            <span id="userCount">0</span> مستخدم نشط
        </div>
    </nav>

    <div class="container">
        <!-- أزرار التنقل بين الصفحات -->
        <div class="nav-tabs">
            <button class="nav-tab active clickable" data-page="timer-page">
                <i class="fas fa-clock"></i> المؤقت
            </button>
            <button class="nav-tab clickable" data-page="settings-page">
                <i class="fas fa-cogs"></i> الإعدادات
            </button>
            <button class="nav-tab clickable" data-page="tasks-page">
                <i class="fas fa-tasks"></i> المهام
            </button>
            <button class="nav-tab clickable" data-page="stats-page">
                <i class="fas fa-chart-line"></i> الإحصائيات
            </button>
        </div>

        <!-- صفحة المؤقت الرئيسية -->
        <div id="timer-page" class="page active">
            <div class="card">
                <div class="timer-modes">
                    <button class="timer-mode active clickable" data-mode="study">
                        <i class="fas fa-book"></i> دراسة
                    </button>
                    <button class="timer-mode clickable" data-mode="shortBreak">
                        <i class="fas fa-coffee"></i> استراحة قصيرة
                    </button>
                    <button class="timer-mode clickable" data-mode="longBreak">
                        <i class="fas fa-couch"></i> استراحة طويلة
                    </button>
                </div>
                
                <div class="timer-display" id="timerDisplay">25:00</div>
                
                <div class="timer-progress">
                    <div class="timer-progress-bar" id="timerProgressBar"></div>
                </div>
                
                <div class="timer-controls">
                    <button class="btn btn-primary clickable" id="startBtn">
                        <i class="fas fa-play"></i> بدء
                    </button>
                    <button class="btn btn-secondary clickable" id="pauseBtn" disabled>
                        <i class="fas fa-pause"></i> إيقاف
                    </button>
                    <button class="btn btn-secondary clickable" id="restartBtn">
                        <i class="fas fa-redo"></i> إعادة
                    </button>
                </div>
                
                <div class="quote-container" id="quoteContainer">
                    "النجاح هو مجموع الجهود الصغيرة المتكررة يومياً."
                </div>
            </div>
        </div>

        <!-- صفحة الإعدادات -->
        <div id="settings-page" class="page">
            <div class="card">
                <h3 class="settings-title"><i class="fas fa-cog"></i> إعدادات المؤقت</h3>
                <div class="setting-item">
                    <label class="setting-label" for="studyTime">
                        <i class="fas fa-book-open"></i> مدة الدراسة (دقائق)
                    </label>
                    <input type="number" class="setting-input" id="studyTime" min="1" max="60" value="25">
                </div>
                <div class="setting-item">
                    <label class="setting-label" for="shortBreakTime">
                        <i class="fas fa-coffee"></i> مدة الاستراحة القصيرة (دقائق)
                    </label>
                    <input type="number" class="setting-input" id="shortBreakTime" min="1" max="30" value="5">
                </div>
                <div class="setting-item">
                    <label class="setting-label" for="longBreakTime">
                        <i class="fas fa-couch"></i> مدة الاستراحة الطويلة (دقائق)
                    </label>
                    <input type="number" class="setting-input" id="longBreakTime" min="1" max="60" value="15">
                </div>
                <div class="setting-item">
                    <label class="setting-label" for="sessionsBeforeLongBreak">
                        <i class="fas fa-redo"></i> عدد الجلسات قبل الاستراحة الطويلة
                    </label>
                    <input type="number" class="setting-input" id="sessionsBeforeLongBreak" min="1" max="10" value="4">
                </div>
            </div>
            
            <div class="card focus-sounds">
                <h3 class="settings-title"><i class="fas fa-volume-up"></i> أصوات التركيز</h3>
                <p>اختر صوتاً خلفياً لمساعدتك على التركيز</p>
                <div class="sound-buttons">
                    <button class="sound-btn clickable" data-sound="rain">
                        <i class="fas fa-cloud-rain"></i> مطر
                    </button>
                    <button class="sound-btn clickable" data-sound="waves">
                        <i class="fas fa-water"></i> أمواج
                    </button>
                    <button class="sound-btn clickable" data-sound="white">
                        <i class="fas fa-wind"></i> ضوضاء بيضاء
                    </button>
                    <button class="sound-btn active clickable" data-sound="none">
                        <i class="fas fa-volume-mute"></i> إيقاف
                    </button>
                </div>

                <div class="audio-controls">
                    <i class="fas fa-volume-up"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                    <span id="volumeValue">50%</span>
                </div>

                <div class="custom-sound-container">
                    <h4 class="setting-label"><i class="fas fa-link"></i> إضافة صوت مخصص</h4>
                    <p>أدخل رابطاً لملف صوتي (MP3, WAV, OGG)</p>
                    <div class="custom-sound-form">
                        <input type="url" class="custom-sound-input" id="customSoundInput" placeholder="https://example.com/sound.mp3">
                        <button class="custom-sound-add clickable" id="customSoundAdd">
                            <i class="fas fa-plus"></i> إضافة
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحة المهام -->
        <div id="tasks-page" class="page">
            <div class="card">
                <h3 class="settings-title"><i class="fas fa-tasks"></i> مهامي</h3>
                <div class="todo-container">
                    <div class="todo-form">
                        <input type="text" class="todo-input" id="todoInput" placeholder="أضف مهمة جديدة...">
                        <button class="todo-add clickable" id="todoAdd">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <ul class="todo-list" id="todoList">
                        <!-- سيتم ملء المهام عبر JavaScript -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- صفحة الإحصائيات -->
        <div id="stats-page" class="page">
            <div class="card">
                <h3 class="settings-title"><i class="fas fa-chart-line"></i> إحصائياتي</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="sessionsToday">0</div>
                        <div class="stat-label">
                            <i class="fas fa-calendar-day"></i> جلسات اليوم
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">
                            <i class="fas fa-fire"></i> السلسلة الحالية
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bestStreak">0</div>
                        <div class="stat-label">
                            <i class="fas fa-trophy"></i> أفضل سلسلة
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSessions">0</div>
                        <div class="stat-label">
                            <i class="fas fa-chart-pie"></i> إجمالي الجلسات
                        </div>
                    </div>
                </div>
                
                <div class="badges-container">
                    <h3 class="settings-title"><i class="fas fa-medal"></i> شارات الإنجاز</h3>
                    <div class="badges-grid" id="badgesGrid">
                        <div class="badge locked clickable">
                            <i class="fas fa-bullseye"></i>
                            <div class="badge-tooltip">غير مكتمل</div>
                        </div>
                        <div class="badge locked clickable">
                            <i class="fas fa-fire"></i>
                            <div class="badge-tooltip">غير مكتمل</div>
                        </div>
                        <div class="badge locked clickable">
                            <i class="fas fa-trophy"></i>
                            <div class="badge-tooltip">غير مكتمل</div>
                        </div>
                        <div class="badge locked clickable">
                            <i class="fas fa-star"></i>
                            <div class="badge-tooltip">غير مكتمل</div>
                        </div>
                        <div class="badge locked clickable">
                            <i class="fas fa-rocket"></i>
                            <div class="badge-tooltip">غير مكتمل</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="challenge-container">
                    <h3 class="settings-title"><i class="fas fa-users"></i> تحدّى صديقك</h3>
                    <p>أنشئ رابط تحدٍ ومشاركته مع أصدقائك</p>
                    <div class="challenge-buttons">
                        <button class="btn btn-primary clickable" id="createChallenge">
                            <i class="fas fa-link"></i> إنشاء تحدٍ
                        </button>
                        <button class="btn btn-secondary clickable" id="joinChallenge">
                            <i class="fas fa-user-plus"></i> الانضمام لتحدٍ
                        </button>
                    </div>
                    <div id="challengeLinkContainer" style="display: none; margin-top: 15px;">
                        <input type="text" id="challengeLink" readonly class="setting-input">
                        <button class="btn btn-primary clickable" id="copyChallenge" style="margin-top: 10px;">
                            <i class="fas fa-copy"></i> نسخ الرابط
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>إنتاج شركة سومر</p>
        </footer>
    </div>

    <!-- منطقة الإشعارات -->
    <div id="notifications-container"></div>

    <!-- عنصر الصوت المخفي -->
    <audio id="background-audio" loop></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // عناصر DOM
            const themeToggle = document.getElementById('themeToggle');
            const timerDisplay = document.getElementById('timerDisplay');
            const progressBar = document.getElementById('timerProgressBar');
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const restartBtn = document.getElementById('restartBtn');
            const timerModes = document.querySelectorAll('.timer-mode');
            const quoteContainer = document.getElementById('quoteContainer');
            const studyTimeInput = document.getElementById('studyTime');
            const shortBreakTimeInput = document.getElementById('shortBreakTime');
            const longBreakTimeInput = document.getElementById('longBreakTime');
            const sessionsInput = document.getElementById('sessionsBeforeLongBreak');
            const todoInput = document.getElementById('todoInput');
            const todoAdd = document.getElementById('todoAdd');
            const todoList = document.getElementById('todoList');
            const sessionsTodayEl = document.getElementById('sessionsToday');
            const currentStreakEl = document.getElementById('currentStreak');
            const bestStreakEl = document.getElementById('bestStreak');
            const totalSessionsEl = document.getElementById('totalSessions');
            const badgesGrid = document.getElementById('badgesGrid');
            const createChallengeBtn = document.getElementById('createChallenge');
            const joinChallengeBtn = document.getElementById('joinChallenge');
            const challengeLinkContainer = document.getElementById('challengeLinkContainer');
            const challengeLink = document.getElementById('challengeLink');
            const copyChallengeBtn = document.getElementById('copyChallenge');
            const soundButtons = document.querySelectorAll('.sound-btn');
            const navTabs = document.querySelectorAll('.nav-tab');
            const pages = document.querySelectorAll('.page');
            const body = document.body;
            const userCountEl = document.getElementById('userCount');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            const customSoundInput = document.getElementById('customSoundInput');
            const customSoundAdd = document.getElementById('customSoundAdd');
            const backgroundAudio = document.getElementById('background-audio');
            const notificationsContainer = document.getElementById('notifications-container');

            // حالة التطبيق
            let state = {
                theme: 'light',
                mode: 'study',
                running: false,
                timeLeft: 25 * 60,
                totalSeconds: 25 * 60,
                sessionsCompleted: 0,
                sessionsToday: 0,
                currentStreak: 0,
                bestStreak: 0,
                totalSessions: 0,
                lastSessionDate: null,
                todos: [],
                badges: {
                    firstSession: false,
                    fiveSessions: false,
                    weekStreak: false,
                    monthStreak: false,
                    hundredSessions: false
                },
                currentSound: null,
                challengeActive: false,
                challengeCode: null,
                lastUpdateTime: 0,
                volume: 50,
                customSounds: []
            };

            // الاقتباسات التحفيزية
            const quotes = [
                "النجاح هو مجموع الجهود الصغيرة المتكررة يومياً.",
                "لا تنتظر الظروف المثالية، فهي لن تأتي أبداً. استغل الظروف الحالية.",
                "أفضل طريقة للتنبؤ بالمستقبل هي صنعه.",
                "التركيز هو أساس النجاح في الحياة.",
                "لا يوجد بديل للعمل الجاد.",
                "الوقت هو المورد الوحيد الذي لا يمكنك استعادته، استخدمه بحكمة.",
                "العقل الذي انفتح على فكرة جديدة لن يعود إلى حجمه السابق.",
                "الاستمرارية هي مفتاح تحقيق الأحلام الكبيرة.",
                "ابدأ من حيث أنت، استخدم ما لديك، افعل ما تستطيع.",
                "التحديات هي ما تجعل الحياة مثيرة للاهتمام، والتغلب عليها هو ما يجعلها ذات معنى."
            ];

            // تهيئة التطبيق
            function init() {
                loadState();
                updateThemeUI();
                updateTimerDisplay();
                updateProgressBar();
                updateStats();
                renderTodos();
                renderBadges();
                showRandomQuote();
                checkStreak();
                setupEventListeners();
                updateUserCount();
                updateVolume();
                
                // بدء حلقة التحديث للمؤقت
                requestAnimationFrame(updateTimer);
            }

            // إعداد مستمعي الأحداث
            function setupEventListeners() {
                themeToggle.addEventListener('click', toggleTheme);
                
                // التنقل بين الصفحات
                navTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const pageId = tab.dataset.page;
                        
                        // إخفاء جميع الصفحات
                        pages.forEach(page => {
                            page.classList.remove('active');
                        });
                        
                        // إظهار الصفحة المحددة
                        document.getElementById(pageId).classList.add('active');
                        
                        // تحديث حالة الأزرار
                        navTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                    });
                });
                
                timerModes.forEach(mode => {
                    mode.addEventListener('click', switchMode);
                });
                
                startBtn.addEventListener('click', startTimer);
                pauseBtn.addEventListener('click', pauseTimer);
                restartBtn.addEventListener('click', restartTimer);
                
                studyTimeInput.addEventListener('change', updateSettings);
                shortBreakTimeInput.addEventListener('change', updateSettings);
                longBreakTimeInput.addEventListener('change', updateSettings);
                sessionsInput.addEventListener('change', updateSettings);
                
                todoAdd.addEventListener('click', addTodo);
                todoInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addTodo();
                });
                
                createChallengeBtn.addEventListener('click', createChallenge);
                joinChallengeBtn.addEventListener('click', joinChallenge);
                copyChallengeBtn.addEventListener('click', copyChallengeLink);
                
                soundButtons.forEach(btn => {
                    btn.addEventListener('click', handleSoundButton);
                });
                
                volumeSlider.addEventListener('input', updateVolume);
                customSoundAdd.addEventListener('click', addCustomSound);
            }

            // تحميل الحالة من localStorage
            function loadState() {
                const saved = localStorage.getItem('sumerState');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        state = {...state, ...parsed};
                        
                        // تحديث واجهة المستخدم بناءً على الحالة المحملة
                        studyTimeInput.value = Math.floor(state.totalSeconds / 60);
                        shortBreakTimeInput.value = parseInt(shortBreakTimeInput.value);
                        longBreakTimeInput.value = parseInt(longBreakTimeInput.value);
                        sessionsInput.value = parseInt(sessionsInput.value);
                        volumeSlider.value = state.volume;
                        volumeValue.textContent = `${state.volume}%`;
                        
                        // تحديث الوضع الحالي
                        timerModes.forEach(mode => mode.classList.remove('active'));
                        document.querySelector(`[data-mode="${state.mode}"]`).classList.add('active');
                        
                        // تحديث الوقت المتبقي
                        updateTimerDisplay();
                        updateProgressBar();
                    } catch (e) {
                        console.error('Error loading state:', e);
                    }
                }
            }

            // حفظ الحالة إلى localStorage
            function saveState() {
                localStorage.setItem('sumerState', JSON.stringify(state));
            }

            // تحديث عدد المستخدمين (محاكاة واقعية)
            function updateUserCount() {
                // محاكاة عدد المستخدمين النشطين حالياً
                const baseUsers = 42;
                const randomUsers = Math.floor(Math.random() * 10);
                const totalUsers = baseUsers + randomUsers;
                
                userCountEl.textContent = totalUsers.toLocaleString('ar-EG');
                
                // تحديث العدد كل دقيقة لمحاكاة التغير
                setTimeout(updateUserCount, 60000);
            }

            // تبديل الوضع الليلي/النهاري
            function toggleTheme() {
                // تم إزالة هذه الميزة بناءً على الطلب
                // ولكن تم الاحتفاظ بالزر لأغراض التصميم فقط
                showNotification('معلومة', 'الوضع الفاتح فقط متاح حالياً', 'info');
            }

            function updateThemeUI() {
                // تم إزالة هذه الميزة بناءً على الطلب
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }

            // تبديل أوضاع المؤقت
            function switchMode(e) {
                if (state.running) return;
                
                timerModes.forEach(m => m.classList.remove('active'));
                e.target.classList.add('active');
                
                state.mode = e.target.dataset.mode;
                updateTotalTime();
                state.timeLeft = state.totalSeconds;
                updateTimerDisplay();
                updateProgressBar();
                saveState();
            }

            function updateTotalTime() {
                if (state.mode === 'study') {
                    state.totalSeconds = parseInt(studyTimeInput.value) * 60;
                } else if (state.mode === 'shortBreak') {
                    state.totalSeconds = parseInt(shortBreakTimeInput.value) * 60;
                } else {
                    state.totalSeconds = parseInt(longBreakTimeInput.value) * 60;
                }
            }

            function updateTimerDisplay() {
                const minutes = Math.floor(state.timeLeft / 60);
                const seconds = state.timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function updateProgressBar() {
                const progress = ((state.totalSeconds - state.timeLeft) / state.totalSeconds) * 100;
                progressBar.style.width = `${progress}%`;
            }

            function updateSettings() {
                updateTotalTime();
                if (!state.running) {
                    state.timeLeft = state.totalSeconds;
                    updateTimerDisplay();
                    updateProgressBar();
                }
                saveState();
            }

            // حلقة التحديث الرئيسية للمؤقت (باستخدام requestAnimationFrame)
            function updateTimer(timestamp) {
                if (!state.lastUpdateTime) {
                    state.lastUpdateTime = timestamp;
                }
                
                const elapsed = timestamp - state.lastUpdateTime;
                
                if (state.running && elapsed >= 1000) {
                    state.timeLeft--;
                    state.lastUpdateTime = timestamp;
                    
                    updateTimerDisplay();
                    updateProgressBar();
                    
                    if (state.timeLeft <= 0) {
                        completeSession();
                    }
                }
                
                requestAnimationFrame(updateTimer);
            }

            // التحكم في المؤقت
            function startTimer() {
                if (state.running) return;
                
                state.running = true;
                state.lastUpdateTime = 0;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                saveState();
            }

            function pauseTimer() {
                if (!state.running) return;
                
                state.running = false;
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                saveState();
            }

            function restartTimer() {
                state.running = false;
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                updateTotalTime();
                state.timeLeft = state.totalSeconds;
                updateTimerDisplay();
                updateProgressBar();
                
                showNotification('إعادة الضبط', 'تم إعادة ضبط المؤقت بنجاح', 'info');
                
                saveState();
            }

            function completeSession() {
                if (state.mode === 'study') {
                    state.sessionsCompleted++;
                    state.sessionsToday++;
                    state.totalSessions++;
                    
                    // تحديث السلسلة
                    const today = new Date().toDateString();
                    if (state.lastSessionDate !== today) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        
                        if (state.lastSessionDate === yesterday.toDateString()) {
                            state.currentStreak++;
                        } else if (state.lastSessionDate !== today) {
                            state.currentStreak = 1;
                        }
                        
                        state.lastSessionDate = today;
                        
                        if (state.currentStreak > state.bestStreak) {
                            state.bestStreak = state.currentStreak;
                        }
                    }
                    
                    // التحقق من الشارات
                    checkBadges();
                    
                    // عرض رسالة الإنجاز
                    showNotification('تهانينا!', 'لقد أكملت جلسة الدراسة بنجاح وحصلت على إنجاز جديد', 'success');
                    
                    // إذا كانت الجلسة مكتملة، انتقل إلى الاستراحة
                    if (state.sessionsCompleted % parseInt(sessionsInput.value) === 0) {
                        state.mode = 'longBreak';
                    } else {
                        state.mode = 'shortBreak';
                    }
                } else {
                    // إذا كانت الاستراحة مكتملة، انتقل إلى الدراسة
                    state.mode = 'study';
                }
                
                // تحديث الواجهة
                timerModes.forEach(mode => mode.classList.remove('active'));
                document.querySelector(`[data-mode="${state.mode}"]`).classList.add('active');
                
                updateTotalTime();
                state.timeLeft = state.totalSeconds;
                updateTimerDisplay();
                updateProgressBar();
                updateStats();
                
                // عرض اقتباس جديد قبل كل جلسة دراسة
                if (state.mode === 'study') {
                    showRandomQuote();
                }
                
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                saveState();
            }

            // إدارة المهام
            function addTodo() {
                const text = todoInput.value.trim();
                if (text) {
                    state.todos.push({ text, completed: false });
                    todoInput.value = '';
                    renderTodos();
                    saveState();
                }
            }

            function renderTodos() {
                todoList.innerHTML = '';
                state.todos.forEach((todo, index) => {
                    const li = document.createElement('li');
                    li.className = 'todo-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'todo-checkbox';
                    checkbox.checked = todo.completed;
                    checkbox.addEventListener('change', () => toggleTodo(index));
                    
                    const span = document.createElement('span');
                    span.className = `todo-text ${todo.completed ? 'completed' : ''}`;
                    span.textContent = todo.text;
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'todo-delete';
                    deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                    deleteBtn.addEventListener('click', () => deleteTodo(index));
                    
                    li.appendChild(checkbox);
                    li.appendChild(span);
                    li.appendChild(deleteBtn);
                    todoList.appendChild(li);
                });
            }

            function toggleTodo(index) {
                state.todos[index].completed = !state.todos[index].completed;
                renderTodos();
                saveState();
            }

            function deleteTodo(index) {
                state.todos.splice(index, 1);
                renderTodos();
                saveState();
            }

            // عرض الإحصائيات
            function updateStats() {
                sessionsTodayEl.textContent = state.sessionsToday;
                currentStreakEl.textContent = state.currentStreak;
                bestStreakEl.textContent = state.bestStreak;
                totalSessionsEl.textContent = state.totalSessions;
            }

            // التحقق من السلسلة اليومية
            function checkStreak() {
                const today = new Date().toDateString();
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (state.lastSessionDate === yesterday.toDateString()) {
                    // المستخدم لديه سلسلة نشطة
                } else if (state.lastSessionDate !== today) {
                    // كسر السلسلة
                    state.currentStreak = 0;
                    saveState();
                    updateStats();
                }
            }

            // إدارة الشارات
            function checkBadges() {
                // أول جلسة
                if (state.totalSessions === 1 && !state.badges.firstSession) {
                    state.badges.firstSession = true;
                    showBadgeNotification('أول جلسة!', 'مبروك على إكمال أول جلسة دراسة!', '🎯');
                }
                
                // 5 جلسات
                if (state.totalSessions >= 5 && !state.badges.fiveSessions) {
                    state.badges.fiveSessions = true;
                    showBadgeNotification('5 جلسات!', 'واصل التقدم!', '🔥');
                }
                
                // أسبوع من الجلسات
                if (state.currentStreak >= 7 && !state.badges.weekStreak) {
                    state.badges.weekStreak = true;
                    showBadgeNotification('أسبوع من الجلسات!', 'أنت ملتزم بشكل رائع!', '🏆');
                }
                
                // شهر من الجلسات
                if (state.currentStreak >= 30 && !state.badges.monthStreak) {
                    state.badges.monthStreak = true;
                    showBadgeNotification('شهر من الجلسات!', 'إنجاز مذهل!', '⭐');
                }
                
                // 100 جلسة
                if (state.totalSessions >= 100 && !state.badges.hundredSessions) {
                    state.badges.hundredSessions = true;
                    showBadgeNotification('100 جلسة!', 'لقد وصلت إلى مستوى جديد!', '🚀');
                }
                
                renderBadges();
                saveState();
            }

            function renderBadges() {
                badgesGrid.innerHTML = '';
                
                const badges = [
                    { id: 'firstSession', icon: 'fa-bullseye', name: 'أول جلسة', desc: 'أكمل أول جلسة دراسة' },
                    { id: 'fiveSessions', icon: 'fa-fire', name: '5 جلسات', desc: 'أكمل 5 جلسات دراسة' },
                    { id: 'weekStreak', icon: 'fa-trophy', name: 'أسبوع متواصل', desc: 'حافظ على سلسلة لمدة أسبوع' },
                    { id: 'monthStreak', icon: 'fa-star', name: 'شهر متواصل', desc: 'حافظ على سلسلة لمدة شهر' },
                    { id: 'hundredSessions', icon: 'fa-rocket', name: '100 جلسة', desc: 'أكمل 100 جلسة دراسة' }
                ];
                
                badges.forEach(badge => {
                    const div = document.createElement('div');
                    div.className = `badge ${state.badges[badge.id] ? '' : 'locked'} clickable`;
                    div.innerHTML = `
                        <i class="fas ${badge.icon}"></i>
                        <div class="badge-tooltip">${state.badges[badge.id] ? badge.desc : 'غير مكتمل'}</div>
                    `;
                    badgesGrid.appendChild(div);
                });
            }

            function showBadgeNotification(title, message, emoji) {
                showNotification(title, `${emoji} ${message}`, 'success');
            }

            // عرض اقتباس عشوائي
            function showRandomQuote() {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                quoteContainer.textContent = `"${randomQuote}"`;
                quoteContainer.style.opacity = '0';
                setTimeout(() => {
                    quoteContainer.style.opacity = '1';
                }, 100);
            }

            // تحدي الأصدقاء
            function createChallenge() {
                const challengeSettings = {
                    studyTime: studyTimeInput.value,
                    shortBreak: shortBreakTimeInput.value,
                    longBreak: longBreakTimeInput.value,
                    sessions: sessionsInput.value,
                    timestamp: Date.now()
                };
                
                state.challengeCode = btoa(JSON.stringify(challengeSettings));
                state.challengeActive = true;
                
                const challengeUrl = `${window.location.origin}${window.location.pathname}?challenge=${state.challengeCode}`;
                challengeLink.value = challengeUrl;
                challengeLinkContainer.style.display = 'block';
                
                saveState();
            }

            function joinChallenge() {
                const code = prompt('أدخل رمز التحدي الذي تلقيته:');
                if (code) {
                    try {
                        const settings = JSON.parse(atob(code));
                        studyTimeInput.value = settings.studyTime;
                        shortBreakTimeInput.value = settings.shortBreak;
                        longBreakTimeInput.value = settings.longBreak;
                        sessionsInput.value = settings.sessions;
                        
                        showNotification('تم قبول التحدي!', 'لقد تم تحديك! هل تستطيع التفوق؟', 'info');
                        
                        // تحديث المؤقت مع الإعدادات الجديدة
                        updateTotalTime();
                        state.timeLeft = state.totalSeconds;
                        updateTimerDisplay();
                        updateProgressBar();
                        
                        saveState();
                    } catch (e) {
                        showNotification('خطأ', 'رمز التحدي غير صالح', 'error');
                    }
                }
            }

            function copyChallengeLink() {
                challengeLink.select();
                document.execCommand('copy');
                showNotification('تم النسخ', 'تم نسخ الرابط إلى الحافظة', 'success');
            }

            // إدارة الأصوات
            function handleSoundButton(e) {
                const sound = e.target.dataset.sound;
                
                soundButtons.forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                // إيقاف أي صوت قيد التشغيل
                backgroundAudio.pause();
                backgroundAudio.currentTime = 0;
                
                // تشغيل الصوت المحدد
                if (sound !== 'none') {
                    state.currentSound = sound;
                    
                    // تعيين مصدر الصوت بناءً على الاختيار
                    let soundSource = '';
                    switch(sound) {
                        case 'rain':
                            soundSource = 'https://assets.mixkit.co/sfx/preview/mixkit-rain-01-196.mp3';
                            break;
                        case 'waves':
                            soundSource = 'https://assets.mixkit.co/sfx/preview/mixkit-waves-ambience-1183.mp3';
                            break;
                        case 'white':
                            soundSource = 'https://assets.mixkit.co/sfx/preview/mixkit-ambient-white-noise-996.mp3';
                            break;
                    }
                    
                    backgroundAudio.src = soundSource;
                    backgroundAudio.volume = state.volume / 100;
                    backgroundAudio.play().catch(e => {
                        console.error('Error playing sound:', e);
                    });
                } else {
                    state.currentSound = null;
                }
                
                saveState();
            }

            function updateVolume() {
                state.volume = volumeSlider.value;
                volumeValue.textContent = `${state.volume}%`;
                backgroundAudio.volume = state.volume / 100;
                saveState();
            }

            function addCustomSound() {
                const url = customSoundInput.value.trim();
                if (url) {
                    // التحقق من أن الرابط يحتوي على امتداد صوتي
                    const audioExtensions = ['.mp3', '.wav', '.ogg', '.m4a'];
                    const hasAudioExtension = audioExtensions.some(ext => url.toLowerCase().includes(ext));
                    
                    if (hasAudioExtension) {
                        state.customSounds.push(url);
                        customSoundInput.value = '';
                        
                        // إنشاء زر للصوت المخصص
                        const soundBtn = document.createElement('button');
                        soundBtn.className = 'sound-btn clickable';
                        soundBtn.dataset.sound = `custom-${state.customSounds.length - 1}`;
                        soundBtn.innerHTML = `<i class="fas fa-music"></i> صوت مخصص ${state.customSounds.length}`;
                        
                        soundBtn.addEventListener('click', function() {
                            soundButtons.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            
                            backgroundAudio.pause();
                            backgroundAudio.currentTime = 0;
                            backgroundAudio.src = url;
                            backgroundAudio.volume = state.volume / 100;
                            backgroundAudio.play().catch(e => {
                                console.error('Error playing custom sound:', e);
                            });
                            
                            state.currentSound = `custom-${state.customSounds.length - 1}`;
                            saveState();
                        });
                        
                        document.querySelector('.sound-buttons').appendChild(soundBtn);
                        saveState();
                        
                        showNotification('تم الإضافة', 'تمت إضافة الصوت المخصص بنجاح', 'success');
                    } else {
                        showNotification('خطأ', 'الرابط يجب أن يشير إلى ملف صوتي (mp3, wav, ogg, m4a)', 'error');
                    }
                }
            }

            // نظام الإشعارات
            function showNotification(title, message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                let icon = 'fa-info-circle';
                if (type === 'success') icon = 'fa-check-circle';
                if (type === 'error') icon = 'fa-exclamation-circle';
                
                notification.innerHTML = `
                    <div class="notification-icon"><i class="fas ${icon}"></i></div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close"><i class="fas fa-times"></i></button>
                `;
                
                notificationsContainer.appendChild(notification);
                
                // إظهار الإشعار
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                // إغلاق الإشعار تلقائياً بعد 5 ثوان
                setTimeout(() => {
                    closeNotification(notification);
                }, 5000);
                
                // إغلاق الإشعار عند النقر على الزر
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    closeNotification(notification);
                });
            }
            
            function closeNotification(notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }

            // بدء التطبيق
            init();
        });
    </script>
</body>
</html>